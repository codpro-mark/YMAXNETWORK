name: YMAX beIN Sports Updater
on:
  schedule:
    - cron: '0 */2 * * *' # تحديث كل ساعتين
  workflow_dispatch: # تشغيل يدوي

jobs:
  update-link:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Fetch beIN Sports Link
        run: |
          # تحميل قائمة القنوات الرياضية
          curl -L -s https://iptv-org.github.io/iptv/categories/sports.m3u -o sports.m3u
          
          # محاولة البحث عن beIN Sports 1 أولاً، ثم beIN بشكل عام، ثم الكأس
          LINK=$(grep -A 1 "beIN Sports 1" sports.m3u | grep "http" | head -n 1)
          if [ -z "$LINK" ]; then
            LINK=$(grep -A 1 "beIN Sports" sports.m3u | grep "http" | head -n 1)
          fi
          if [ -z "$LINK" ]; then
            LINK=$(grep -A 1 "Alkass One" sports.m3u | grep "http" | head -n 1)
          fi
          
          # إذا لم يجد شيئاً، يضع رابط دبي الرياضية المضمون 100%
          if [ ! -z "$LINK" ]; then
            echo "$LINK" > link.txt
          else
            echo "https://raw.githubusercontent.com/iptv-org/iptv/master/streams/ar/dubaisports1.m3u8" > link.txt
          fi

      - name: Commit and Push
        run: |
          git config --global user.name 'ymax-bot'
          git config --global user.email 'bot@ymax.net'
          git add link.txt
          git commit -m "Updated to beIN Sports Link" || exit 0
          git push
